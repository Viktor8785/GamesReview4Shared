import{gamesData}from"./games-data.js";const pageBody=document.querySelector(".page__body"),cardContainer=document.querySelector(".item__card-container"),gameName=document.querySelector(".item__name"),gameGenre=document.querySelector(".item__genre"),gameRating=document.querySelector(".item__img-rating"),gameText=document.querySelector(".item__text"),img1=document.querySelector("#img1"),img2=document.querySelector("#img2"),img3=document.querySelector("#img3"),buttonBack=document.querySelector(".item__button-back"),buttonLeft=document.querySelector(".item__button-left"),span2=document.querySelector(".item__span2"),buttonWatchlist=document.querySelector(".item__button-watchlist"),buttonWish=document.querySelector(".item__button-wish"),buttonRight=document.querySelector(".item__button-right"),watchButton=document.querySelector("#wish-button"),loadButton=document.querySelector("#load-button"),mediaQueryMobileOnly=window.matchMedia("(max-width: 719px"),mediaQueryTabletOnly=window.matchMedia("(min-width: 720px)");let urlParams=new URLSearchParams(window.location.search),param2=urlParams.get("param2"),param=urlParams.get("param"),leftXs=[],game=gamesData.find((e=>e.id==param)),leftXMax=-374,currentIndex=0,leftX=0;pageBody.style.minHeight=window.innerHeight+"px",span2.textContent="Back",cardContainer.style.left=0;for(let e=0;e<3;e++)leftXs[e]=leftXMax*e;let watchListFlag=!1,watchList=localStorage.getItem("wish");function makeImageLink(){const e=document.createElement("canvas"),t=e.getContext("2d"),a=new Image;let n="";switch(currentIndex){case 0:n=game.imgFile+"1.jpg";break;case 1:n=game.imgFile+"2.jpg";break;case 2:n=game.imgFile+"3.jpg"}a.onload=function(){e.width=a.width,e.height=a.height,t.drawImage(a,0,0),loadButton.href=e.toDataURL("image/jpeg"),loadButton.download="image.jpg"},a.src=n}function handleWidthChangeMobile(e){e.matches&&(leftXMax=window.innerWidth,leftXMax>430&&(leftXMax=430),leftXMax*=-1,settings())}function handleWidthChangeTablet(e){e.matches&&(leftXMax=-600,settings())}function settings(){currentIndex=0;for(let e=0;e<3;e++)leftXs[e]=leftXMax*e;leftX=0,cardContainer.style.left=0}watchList&&watchList.indexOf(param)>=0&&(watchListFlag=!0,buttonWish.classList.add("item__button-wish--active")),img1.src=game.imgFile+"1.jpg",gameName.textContent=game.name,img1.alt=game.name,gameGenre.textContent=game.genre,img2.src=game.imgFile+"2.jpg",gameRating.textContent=game.rating,img2.alt=game.name,img3.src=game.imgFile+"3.jpg",gameText.textContent=game.text,img3.alt=game.name,handleWidthChangeTablet(mediaQueryTabletOnly),handleWidthChangeMobile(mediaQueryMobileOnly),makeImageLink(),buttonBack.addEventListener("click",(()=>{param2?window.location.href="home"==param2?"index.html":"games.html?param=watch":window.history.go(-1)})),buttonLeft.addEventListener("click",(()=>{currentIndex>0&&(currentIndex--,leftX=leftXs[currentIndex],cardContainer.style.left=leftX+"px",makeImageLink())})),buttonWatchlist.addEventListener("click",(()=>{buttonWish.classList.toggle("item__button-wish--active"),watchList=localStorage.getItem("wish");let e="";if(watchListFlag)if(watchListFlag=!1,3==watchList.length)e="";else{let t=watchList.indexOf(param);0==t&&(e=watchList.slice(watchList.indexOf(param)+3)),t==watchList.length-3&&(e=watchList.slice(0,watchList.indexOf(param))),t>0&&t<watchList.length-3&&(e=watchList.slice(0,watchList.indexOf(param))+watchList.slice(watchList.indexOf(param)+3))}else e=param+" ",watchList&&watchList.length>0&&(e=watchList+param+" "),watchListFlag=!0;localStorage.setItem("wish",e)})),buttonRight.addEventListener("click",(()=>{currentIndex<2&&(currentIndex++,leftX=leftXs[currentIndex],cardContainer.style.left=leftX+"px",makeImageLink())})),watchButton.addEventListener("click",(()=>{watchButton.href="games.html?param=watch"})),mediaQueryMobileOnly.addEventListener("change",handleWidthChangeMobile),mediaQueryTabletOnly.addEventListener("change",handleWidthChangeTablet);